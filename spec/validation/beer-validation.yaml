beer_validation_rules:

  add_beer:
    endpoint: POST /api/beers
    fields:
      brand_name:
        type: string
        required: true
        min_length: 1
        max_length: 255
        sanitization:
          - trim_whitespace
          - title_case
        validation_rules:
          - required
          - string
          - min:1
          - max:255
        business_rules:
          - create_if_not_exists: brands
        error_messages:
          required: "品牌名稱為必填項目。"
          string: "品牌名稱必須是字串格式。"
          min: "品牌名稱不得為空。"
          max: "品牌名稱不得超過 255 個字元。"
      
      name:
        type: string
        required: true
        min_length: 1
        max_length: 255
        sanitization:
          - trim_whitespace
        validation_rules:
          - required
          - string
          - min:1
          - max:255
        business_rules:
          - unique_per_user_brand: "brand_name + name combination must be unique per user"
        error_messages:
          required: "啤酒名稱為必填項目。"
          string: "啤酒名稱必須是字串格式。"
          min: "啤酒名稱不得為空。"
          max: "啤酒名稱不得超過 255 個字元。"
          unique_per_user_brand: "您已經追蹤過此品牌的這款啤酒。"
      
      style:
        type: string
        required: false
        max_length: 100
        sanitization:
          - trim_whitespace
          - title_case
        validation_rules:
          - nullable
          - string
          - max:100
        error_messages:
          string: "啤酒類型必須是字串格式。"
          max: "啤酒類型不得超過 100 個字元。"

  count_actions:
    endpoint: POST /api/beers/{id}/count_actions
    path_parameters:
      id:
        type: integer
        required: true
        validation_rules:
          - required
          - integer
          - exists:user_beer_counts,beer_id,user_id,{auth_user_id}
        error_messages:
          required: "啤酒 ID 為必填項目。"
          integer: "啤酒 ID 必須是整數。"
          exists: "找不到此啤酒記錄。"
    
    fields:
      action:
        type: string
        required: true
        allowed_values: [increment, decrement]
        validation_rules:
          - required
          - string
          - in:increment,decrement
        business_rules:
          - decrement_not_below_zero: "Cannot decrement count below zero"
        error_messages:
          required: "操作類型為必填項目。"
          string: "操作類型必須是字串格式。"
          in: "操作類型只能是 increment 或 decrement。"
          decrement_not_below_zero: "計數不能減至負數。"

  get_beers_list:
    endpoint: GET /api/beers
    query_parameters:
      sort:
        type: string
        required: false
        allowed_values: ["-tasted_at", "tasted_at", "-count", "count", "-name", "name"]
        default: "-tasted_at"
        validation_rules:
          - nullable
          - string
          - in:-tasted_at,tasted_at,-count,count,-name,name
        error_messages:
          string: "排序參數必須是字串格式。"
          in: "排序參數只能是 -tasted_at, tasted_at, -count, count, -name, name 其中之一。"
      
      brand_id:
        type: integer
        required: false
        validation_rules:
          - nullable
          - integer
          - exists:brands,id
        error_messages:
          integer: "品牌 ID 必須是整數。"
          exists: "指定的品牌不存在。"

  get_tasting_logs:
    endpoint: GET /api/beers/{id}/tasting_logs
    path_parameters:
      id:
        type: integer
        required: true
        validation_rules:
          - required
          - integer
          - exists:user_beer_counts,beer_id,user_id,{auth_user_id}
        error_messages:
          required: "啤酒 ID 為必填項目。"
          integer: "啤酒 ID 必須是整數。"
          exists: "找不到此啤酒記錄。"

business_validation_rules:
  user_beer_ownership:
    description: "確保用戶只能存取自己的啤酒記錄"
    applies_to:
      - POST /api/beers/{id}/count_actions
      - GET /api/beers/{id}/tasting_logs
    rule: "user_beer_counts.user_id = authenticated_user.id"
    error_message: "您只能存取自己的啤酒記錄。"
  
  beer_brand_uniqueness:
    description: "每個用戶的品牌+啤酒名稱組合必須唯一"
    applies_to:
      - POST /api/beers
    rule: "brand_name + name combination unique per user"
    error_message: "您已經追蹤過此品牌的這款啤酒。"
  
  count_non_negative:
    description: "啤酒計數不能為負數"
    applies_to:
      - POST /api/beers/{id}/count_actions
    rule: "user_beer_counts.count >= 0 after decrement"
    error_message: "計數不能減至負數。"

sanitization_rules:
  global:
    trim_whitespace: "移除字串前後空白"
    title_case: "轉換為標題格式 (首字母大寫)"
    lowercase: "轉換為小寫"
  
  security:
    prevent_xss: "防止 XSS 攻擊的字元轉義"
    prevent_sql_injection: "防止 SQL 注入的參數綁定"